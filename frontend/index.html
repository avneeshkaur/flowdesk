<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FlowDesk â€” Enterprise Workflow</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #05080f;
      --glass: rgba(255,255,255,0.04);
      --glass2: rgba(255,255,255,0.07);
      --border: rgba(255,255,255,0.08);
      --border2: rgba(255,255,255,0.13);
      --accent: #6ea8fe;
      --accent2: #a78bfa;
      --green: #34d399;
      --amber: #fbbf24;
      --red: #f87171;
      --text: #e8ecf4;
      --text2: #94a3b8;
      --text3: #374151;
    }
    html,body{height:100%;}
    body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}

    /* BG */
    .bg-scene{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;}
    .bg-scene::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 90% 70% at 15% -5%,rgba(110,168,254,.12) 0%,transparent 55%),radial-gradient(ellipse 60% 55% at 85% 105%,rgba(167,139,250,.09) 0%,transparent 55%);}
    .bg-scene::after{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.018) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.018) 1px,transparent 1px);background-size:56px 56px;}
    .orb{position:absolute;border-radius:50%;filter:blur(80px);animation:drift 12s ease-in-out infinite alternate;}
    .orb1{width:380px;height:380px;top:-80px;left:-80px;background:rgba(110,168,254,.12);animation-delay:0s;}
    .orb2{width:280px;height:280px;bottom:-60px;right:-60px;background:rgba(167,139,250,.10);animation-delay:-5s;}
    @keyframes drift{from{transform:translate(0,0) scale(1);}to{transform:translate(25px,18px) scale(1.07);}}

    #app{position:relative;z-index:1;min-height:100vh;}
    .page{display:none;min-height:100vh;}
    .page.active{display:flex;}

    /* â”€â”€ LOGIN â”€â”€ */
    #login-page{align-items:center;justify-content:center;padding:1.5rem;}
    .login-wrap{
      display:grid;grid-template-columns:1fr 420px;
      width:100%;max-width:880px;min-height:540px;
      border-radius:24px;overflow:hidden;
      border:1px solid var(--border2);
      box-shadow:0 40px 100px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,.04) inset;
      animation:riseIn .7s cubic-bezier(.16,1,.3,1) both;
    }
    @keyframes riseIn{from{opacity:0;transform:translateY(28px) scale(.97);}to{opacity:1;transform:translateY(0) scale(1);}}

    .login-left{
      background:linear-gradient(145deg,rgba(110,168,254,.1),rgba(167,139,250,.06));
      backdrop-filter:blur(20px);padding:2.8rem;
      display:flex;flex-direction:column;justify-content:space-between;
      border-right:1px solid var(--border);position:relative;overflow:hidden;
    }
    .ll-brand{display:flex;align-items:center;gap:11px;}
    .ll-logo{width:40px;height:40px;border-radius:11px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 8px 24px rgba(110,168,254,.25);}
    .ll-name{font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:700;}
    .ll-name span{color:var(--accent);}
    .ll-tagline{font-family:'Cormorant Garamond',serif;font-size:2.2rem;font-weight:600;line-height:1.2;color:var(--text);}
    .ll-tagline em{color:var(--accent);font-style:normal;}
    .ll-sub{font-size:.84rem;color:var(--text2);line-height:1.7;margin-top:.7rem;}
    .ll-feats{display:flex;flex-direction:column;gap:9px;}
    .ll-feat{display:flex;align-items:center;gap:9px;font-size:.8rem;color:var(--text2);}
    .ll-dot{width:5px;height:5px;border-radius:50%;background:var(--green);flex-shrink:0;}

    .login-right{background:rgba(5,8,15,.88);backdrop-filter:blur(24px);padding:2.4rem;display:flex;flex-direction:column;justify-content:center;}
    .lr-title{font-family:'Cormorant Garamond',serif;font-size:1.75rem;font-weight:600;margin-bottom:.25rem;}
    .lr-sub{font-size:.8rem;color:var(--text2);margin-bottom:1.6rem;}

    .tabs{display:flex;background:var(--glass);border:1px solid var(--border);border-radius:10px;padding:3px;margin-bottom:1.4rem;}
    .tab-btn{flex:1;padding:8px;background:transparent;border:none;color:var(--text2);font-family:'Outfit',sans-serif;font-size:.83rem;border-radius:8px;cursor:pointer;transition:all .2s;}
    .tab-btn.active{background:var(--glass2);color:var(--text);box-shadow:0 2px 10px rgba(0,0,0,.3);}
    .tab-content{display:none;}
    .tab-content.active{display:block;}

    .fg{margin-bottom:.9rem;}
    .fl{display:block;font-size:.7rem;font-weight:500;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.8px;}
    .fi,.fsel{width:100%;padding:10px 13px;background:var(--glass);border:1px solid var(--border2);border-radius:10px;color:var(--text);font-family:'Outfit',sans-serif;font-size:.88rem;outline:none;transition:all .2s;-webkit-appearance:none;}
    .fi::placeholder{color:var(--text3);}
    .fi:focus,.fsel:focus{border-color:rgba(110,168,254,.45);background:rgba(110,168,254,.04);box-shadow:0 0 0 3px rgba(110,168,254,.08);}
    .fsel option{background:#0d1117;}

    .btn-p{width:100%;padding:12px;background:linear-gradient(135deg,#4f8ef7,#6366f1);border:none;border-radius:10px;color:#fff;font-family:'Outfit',sans-serif;font-size:.88rem;font-weight:500;cursor:pointer;margin-top:.3rem;transition:all .2s;box-shadow:0 4px 18px rgba(79,142,247,.28);}
    .btn-p:hover{transform:translateY(-1px);box-shadow:0 8px 26px rgba(79,142,247,.38);}

    .err-box{background:rgba(248,113,113,.09);border:1px solid rgba(248,113,113,.18);color:#fca5a5;border-radius:8px;padding:9px 12px;font-size:.8rem;margin-top:.6rem;display:none;}

    .demo-box{margin-top:.9rem;background:var(--glass);border:1px solid var(--border);border-radius:10px;padding:11px;}
    .demo-lbl{font-size:.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:7px;font-weight:600;}
    .demo-btns{display:flex;flex-wrap:wrap;gap:5px;}
    .db{padding:5px 11px;border-radius:6px;font-size:.72rem;cursor:pointer;font-family:'Outfit',sans-serif;font-weight:500;border:1px solid;transition:opacity .2s;}
    .db:hover{opacity:.75;}
    .db-e{background:rgba(52,211,153,.09);color:#6ee7b7;border-color:rgba(52,211,153,.18);}
    .db-m{background:rgba(110,168,254,.09);color:#93c5fd;border-color:rgba(110,168,254,.18);}
    .db-h{background:rgba(167,139,250,.09);color:#c4b5fd;border-color:rgba(167,139,250,.18);}
    .db-a{background:rgba(251,191,36,.09);color:#fde68a;border-color:rgba(251,191,36,.18);}

    /* â”€â”€ MAIN APP â”€â”€ */
    #main-page{flex-direction:column;}

    .topbar{height:60px;display:flex;align-items:center;padding:0 1.4rem;gap:.7rem;background:rgba(5,8,15,.82);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200;}
    .tb-logo{display:flex;align-items:center;gap:9px;margin-right:auto;}
    .tb-icon{width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;}
    .tb-name{font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-weight:700;}
    .tb-name span{color:var(--accent);}
    .user-chip{display:flex;align-items:center;gap:8px;background:var(--glass);border:1px solid var(--border2);border-radius:50px;padding:4px 14px 4px 4px;}
    .u-av{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;flex-shrink:0;}
    .u-nm{font-size:.82rem;font-weight:500;}
    .u-rl{font-size:.65rem;color:var(--text2);text-transform:uppercase;letter-spacing:.5px;}
    .btn-out{background:transparent;border:1px solid var(--border2);color:var(--text2);padding:7px 16px;border-radius:8px;font-size:.8rem;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .2s;white-space:nowrap;}
    .btn-out:hover{color:var(--red);border-color:rgba(248,113,113,.35);}

    /* hamburger */
    .ham{display:none;flex-direction:column;gap:4px;cursor:pointer;padding:6px;background:none;border:none;}
    .ham span{display:block;width:22px;height:2px;background:var(--text2);border-radius:2px;transition:all .2s;}

    .app-layout{display:flex;flex:1;position:relative;}

    /* sidebar */
    .sidebar{width:220px;min-height:calc(100vh - 60px);border-right:1px solid var(--border);padding:1.2rem .8rem;background:rgba(5,8,15,.35);flex-shrink:0;transition:transform .25s ease;}
    .nav-sec{margin-bottom:1.6rem;}
    .nav-lbl{font-size:.64rem;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;padding:0 10px;margin-bottom:6px;font-weight:600;}
    .nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;font-size:.85rem;cursor:pointer;color:var(--text2);transition:all .15s;margin-bottom:2px;}
    .nav-item:hover{color:var(--text);background:var(--glass);}
    .nav-item.active{color:var(--accent);background:rgba(110,168,254,.07);}
    .nav-icon{font-size:15px;width:18px;text-align:center;}

    /* sidebar overlay for mobile */
    .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:160;} /* sidebar se zyada */

    .content{flex:1;padding:2rem;overflow-y:auto;min-width:0;}
    .view{display:none;}
    .view.active{display:block;}

    .ph{margin-bottom:1.8rem;}
    .pt{font-family:'Cormorant Garamond',serif;font-size:1.8rem;font-weight:600;margin-bottom:4px;}
    .ps{color:var(--text2);font-size:.85rem;}

    .welcome{background:linear-gradient(135deg,rgba(110,168,254,.07),rgba(167,139,250,.04));border:1px solid rgba(110,168,254,.13);border-radius:16px;padding:1.4rem 1.6rem;margin-bottom:1.6rem;position:relative;overflow:hidden;}
    .welcome::after{content:'â—ˆ';position:absolute;right:1.6rem;top:50%;transform:translateY(-50%);font-size:3rem;color:var(--accent);opacity:.07;}
    .wt{font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-weight:600;margin-bottom:3px;}
    .ws{font-size:.83rem;color:var(--text2);}

    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1.1rem;margin-bottom:1.6rem;}
    .stat{background:var(--glass);border:1px solid var(--border);border-radius:16px;padding:1.3rem;position:relative;overflow:hidden;animation:fu .5s ease both;}
    .stat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
    .s-b::before{background:linear-gradient(90deg,var(--accent),var(--accent2));}
    .s-g::before{background:var(--green);}
    .s-a::before{background:var(--amber);}
    .s-r::before{background:var(--red);}
    .sl{font-size:.7rem;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px;}
    .sv{font-family:'Cormorant Garamond',serif;font-size:2.3rem;font-weight:700;line-height:1;}
    .si{position:absolute;right:1rem;top:1rem;font-size:1.3rem;opacity:.1;}
    @keyframes fu{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}
    .d1{animation-delay:.05s}.d2{animation-delay:.1s}.d3{animation-delay:.15s}.d4{animation-delay:.2s}

    .card{background:var(--glass);border:1px solid var(--border);border-radius:16px;padding:1.5rem;margin-bottom:1.2rem;}
    .ct{font-family:'Cormorant Garamond',serif;font-size:1.1rem;font-weight:600;margin-bottom:1.1rem;}

    .tw{overflow-x:auto;-webkit-overflow-scrolling:touch;}
    table{width:100%;border-collapse:collapse;min-width:600px;}
    th{text-align:left;font-size:.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--text3);padding:10px 12px;border-bottom:1px solid var(--border);font-weight:600;}
    td{padding:12px;font-size:.85rem;border-bottom:1px solid rgba(255,255,255,.03);vertical-align:middle;}
    tr:last-child td{border-bottom:none;}
    tr:hover td{background:rgba(255,255,255,.014);}

    .badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:50px;font-size:.7rem;font-weight:500;letter-spacing:.3px;text-transform:uppercase;border:1px solid;}
    .b-pend{background:rgba(251,191,36,.09);color:#fcd34d;border-color:rgba(251,191,36,.15);}
    .b-appr{background:rgba(52,211,153,.09);color:#6ee7b7;border-color:rgba(52,211,153,.15);}
    .b-reje{background:rgba(248,113,113,.09);color:#fca5a5;border-color:rgba(248,113,113,.15);}
    .b-esca{background:rgba(248,113,113,.09);color:#fca5a5;border-color:rgba(248,113,113,.15);}
    .b-l1{background:rgba(110,168,254,.09);color:#93c5fd;border-color:rgba(110,168,254,.15);}
    .b-l2{background:rgba(167,139,250,.09);color:#c4b5fd;border-color:rgba(167,139,250,.15);}
    .b-l3{background:rgba(251,191,36,.09);color:#fde68a;border-color:rgba(251,191,36,.15);}

    .bsm{padding:6px 14px;font-size:.78rem;border-radius:8px;cursor:pointer;font-family:'Outfit',sans-serif;font-weight:500;transition:opacity .2s;border:1px solid;}
    .bv{background:rgba(110,168,254,.09);color:#93c5fd;border-color:rgba(110,168,254,.18);}
    .bapp{background:rgba(52,211,153,.09);color:#6ee7b7;border-color:rgba(52,211,153,.18);}
    .brej{background:rgba(248,113,113,.09);color:#fca5a5;border-color:rgba(248,113,113,.18);}
    .bsm:hover{opacity:.72;}

    .btn-s{padding:10px 18px;background:var(--glass);border:1px solid var(--border2);border-radius:10px;color:var(--text2);font-family:'Outfit',sans-serif;font-size:.85rem;cursor:pointer;transition:all .2s;}
    .btn-s:hover{color:var(--accent);border-color:rgba(110,168,254,.28);}

    .fg2{margin-bottom:1rem;}
    .fr{display:grid;grid-template-columns:1fr 1fr;gap:1.1rem;}
    .fta{width:100%;padding:12px 14px;background:var(--glass);border:1px solid var(--border2);border-radius:10px;color:var(--text);font-family:'Outfit',sans-serif;font-size:.88rem;outline:none;resize:vertical;min-height:90px;transition:all .2s;}
    .fta:focus{border-color:rgba(110,168,254,.4);}
    .fta::placeholder{color:var(--text3);}

    .lvl-steps{display:flex;margin:1.1rem 0;}
    .lvl-step{flex:1;text-align:center;position:relative;}
    .lvl-step:not(:last-child)::after{content:'';position:absolute;top:16px;left:50%;right:-50%;height:1px;background:var(--border);z-index:0;}
    .lc{width:32px;height:32px;border-radius:50%;background:var(--glass);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:600;margin:0 auto 6px;position:relative;z-index:1;}
    .lc.a{background:rgba(110,168,254,.18);border-color:var(--accent);color:var(--accent);}
    .lc.d{background:rgba(52,211,153,.13);border-color:var(--green);color:var(--green);}
    .lt{font-size:.7rem;color:var(--text2);}

    .timeline{padding-left:24px;position:relative;}
    .timeline::before{content:'';position:absolute;left:6px;top:0;bottom:0;width:1px;background:var(--border);}
    .tl-item{position:relative;margin-bottom:1.2rem;animation:fu .4s ease both;}
    .tl-dot{position:absolute;left:-19px;top:4px;width:10px;height:10px;border-radius:50%;background:var(--accent);border:2px solid var(--bg);}
    .tl-dot.done{background:var(--green);}
    .tl-dot.wait{background:var(--text3);}
    .tl-dot.rej{background:var(--red);}
    .tl-t{font-size:.86rem;font-weight:500;margin-bottom:3px;}
    .tl-m{font-size:.72rem;color:var(--text2);}

    .empty{text-align:center;padding:2.6rem 1rem;color:var(--text3);}
    .ei{font-size:2rem;margin-bottom:.6rem;opacity:.35;}
    .et{font-size:.85rem;}

    .toast{position:fixed;bottom:1.6rem;right:1.6rem;z-index:999;padding:12px 20px;border-radius:10px;font-size:.85rem;font-weight:500;transform:translateY(60px);opacity:0;transition:all .3s;pointer-events:none;background:var(--green);color:#052e16;}
    .toast.show{transform:translateY(0);opacity:1;}
    .toast.err{background:var(--red);color:#fff;}

    .dg{display:grid;grid-template-columns:1fr 320px;gap:1.2rem;align-items:start;}

    .ri{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.035);}
    .ri:last-child{border-bottom:none;}
    .rt{font-size:.86rem;font-weight:500;margin-bottom:3px;}
    .rm{font-size:.72rem;color:var(--text2);}

    .ab-item{margin-bottom:14px;}
    .ab-h{display:flex;justify-content:space-between;font-size:.8rem;margin-bottom:5px;}
    .ab-tr{background:var(--glass2);border-radius:50px;height:6px;overflow:hidden;}
    .ab-fi{height:100%;border-radius:50px;transition:width .9s ease;}

    /* bottom nav for mobile */
    .bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;height:66px;background:rgba(5,8,15,.96);backdrop-filter:blur(16px);border-top:1px solid var(--border);z-index:190;align-items:center;justify-content:space-around;padding:0 .6rem;}
    .bn-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 14px;border-radius:12px;cursor:pointer;color:var(--text3);transition:all .2s;border:none;background:none;font-family:'Outfit',sans-serif;}
    .bn-item.active{color:var(--accent);}
    .bn-icon{font-size:20px;}
    .bn-label{font-size:.58rem;text-transform:uppercase;letter-spacing:.5px;font-weight:500;}

    .hidden{display:none!important;}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TABLET  (768px â€“ 1100px)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media(min-width:768px) and (max-width:1100px){
      .login-wrap{max-width:750px;grid-template-columns:1fr 400px;}
      .ll-tagline{font-size:1.85rem;}
      .login-right{padding:2rem;}
      
      .sidebar{width:200px;padding:1rem .7rem;}
      .nav-item{padding:9px 10px;font-size:.82rem;}
      .content{padding:1.6rem;}
      .pt{font-size:1.6rem;}
      .stats-grid{grid-template-columns:repeat(2,1fr);}
      .dg{grid-template-columns:1fr 280px;}
      table{min-width:550px;}
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE  (â‰¤ 767px)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media(max-width:767px){
      /* Login */
      #login-page{padding:1rem;align-items:flex-start;padding-top:2.5rem;}
      .login-wrap{grid-template-columns:1fr;min-height:auto;border-radius:20px;}
      .login-left{display:none;}
      .login-right{padding:2rem 1.6rem;}
      .lr-title{font-size:1.6rem;}

      /* Topbar */
      .topbar{padding:0 1.2rem;height:56px;gap:.6rem;}
      .tb-icon{width:28px;height:28px;font-size:13px;}
      .tb-name{font-size:1.05rem;}
      .u-av{width:28px;height:28px;font-size:11px;}
      .u-nm,.u-rl{display:none;}
      .user-chip{padding:4px;}
      .btn-out{display:none;}
      .ham{display:flex;}

      /* Sidebar â€” overlay only on mobile */
      .app-layout{display:block!important;width:100%;}
      .sidebar{
        position:fixed;top:56px;left:0;bottom:66px;
         width:260px;z-index:155;
        transform:translateX(-100%);
        border-right:1px solid var(--border2);
        background:rgba(5,8,15,.98);
        backdrop-filter:blur(20px);
        padding-top:1.5rem;
        min-height:unset;
        overflow-y:auto;
      }
      .sidebar.open{transform:translateX(0);}

      /* Content â€” always full width */
      .content{padding:1.2rem;padding-bottom:88px;width:100%;box-sizing:border-box;}
      .pt{font-size:1.5rem;}
      .ps{font-size:.8rem;}
      .welcome{padding:1.2rem 1.3rem;}
      .wt{font-size:1.05rem;}
      .ws{font-size:.78rem;}
      .stats-grid{grid-template-columns:1fr 1fr;gap:.8rem;}
      .stat{padding:1rem;}
      .sl{font-size:.65rem;}
      .sv{font-size:1.9rem;}
      .card{padding:1.2rem;}
      .ct{font-size:1rem;}

      /* Form */
      .fr{grid-template-columns:1fr;}
      table{min-width:500px;}

      /* Detail grid */
      .dg{grid-template-columns:1fr;}

      /* Bottom nav */
      .bottom-nav{display:flex;}

      /* Toast */
      .toast{left:1.2rem;right:1.2rem;text-align:center;}

      /* Table scroll hint */
      .tw::after{content:'â† scroll â†’';display:block;font-size:.68rem;color:var(--text3);text-align:center;padding:.5rem 0;}
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VERY SMALL  (â‰¤ 400px)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media(max-width:400px){
      .login-right{padding:1.6rem 1.3rem;}
      .stats-grid{grid-template-columns:1fr 1fr;gap:.7rem;}
      .stat{padding:.9rem;}
      .sv{font-size:1.6rem;}
      .demo-btns{justify-content:center;}
      .db{flex:1;text-align:center;min-width:70px;}
      .bn-item{padding:6px 10px;}
      .bn-label{font-size:.54rem;}
    }
  </style>
</head>
<body>
<div class="bg-scene"><div class="orb orb1"></div><div class="orb orb2"></div></div>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
<div id="app">

<!-- LOGIN -->
<div id="login-page" class="page active">
  <div class="login-wrap">
    <div class="login-left">
      <div class="ll-brand">
        <div class="ll-logo">ğŸ”„</div>
        <div class="ll-name">Flow<span>Desk</span></div>
      </div>
      <div>
        <div class="ll-tagline">Enterprise<br/><em>Workflow</em><br/>Simplified.</div>
        <div class="ll-sub">3-level approval engine with real-time SLA tracking, audit trails, and role-based access control.</div>
      </div>
      <div class="ll-feats">
        <div class="ll-feat"><div class="ll-dot"></div>Multi-level approval matrix</div>
        <div class="ll-feat"><div class="ll-dot"></div>48hr SLA with auto-escalation</div>
        <div class="ll-feat"><div class="ll-dot"></div>Full audit trail + IP logging</div>
        <div class="ll-feat"><div class="ll-dot"></div>Role-based access control</div>
      </div>
    </div>
    <div class="login-right">
      <div class="lr-title">Welcome back</div>
      <div class="lr-sub">Sign in to your workspace</div>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('login')">Sign In</button>
        <button class="tab-btn" onclick="switchTab('register')">Register</button>
      </div>
      <div id="tab-login" class="tab-content active">
        <div class="fg"><label class="fl">Email</label><input id="login-email" type="email" class="fi" placeholder="you@company.com"/></div>
        <div class="fg"><label class="fl">Password</label><input id="login-password" type="password" class="fi" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/></div>
        <button class="btn-p" onclick="handleLogin()">Sign In â†’</button>
        <div id="login-err" class="err-box"></div>
        <div class="demo-box">
          <div class="demo-lbl">Quick Demo Access</div>
          <div class="demo-btns">
            <button class="db db-e" onclick="demoLogin('employee@test.com','123456')">ğŸ‘¤ Employee</button>
            <button class="db db-m" onclick="demoLogin('manager@test.com','123456')">ğŸ‘” Manager</button>
            <button class="db db-h" onclick="demoLogin('hr@test.com','123456')">ğŸ¢ HR</button>
            <button class="db db-a" onclick="demoLogin('admin@test.com','123456')">âš¡ Admin</button>
          </div>
        </div>
      </div>
      <div id="tab-register" class="tab-content">
        <div class="fg"><label class="fl">Full Name</label><input id="reg-name" type="text" class="fi" placeholder="Your name"/></div>
        <div class="fg"><label class="fl">Email</label><input id="reg-email" type="email" class="fi" placeholder="you@company.com"/></div>
        <div class="fg"><label class="fl">Password</label><input id="reg-password" type="password" class="fi" placeholder="Min 6 characters"/></div>
        <div class="fg"><label class="fl">Role</label><select id="reg-role" class="fsel"><option value="employee">Employee</option><option value="manager">Manager</option><option value="hr">HR</option><option value="admin">Admin</option></select></div>
        <button class="btn-p" onclick="handleRegister()">Create Account â†’</button>
        <div id="reg-err" class="err-box"></div>
      </div>
    </div>
  </div>
</div>

<!-- MAIN -->
<div id="main-page" class="page">
  <div class="topbar">
    <button class="ham" id="ham-btn" onclick="toggleSidebar()">
      <span></span><span></span><span></span>
    </button>
    <div class="tb-logo">
      <div class="tb-icon">ğŸ”„</div>
      <div class="tb-name">Flow<span>Desk</span></div>
    </div>
    <div class="user-chip">
      <div class="u-av" id="top-av">AK</div>
      <div><div class="u-nm" id="top-nm">â€”</div><div class="u-rl" id="top-rl">â€”</div></div>
    </div>
    <button class="btn-out" onclick="logout()">Sign out</button>
  </div>

  <div class="app-layout">
    <div class="sidebar" id="sidebar">
      <div class="nav-sec">
        <div class="nav-lbl">Overview</div>
        <div class="nav-item active" id="nav-dashboard" onclick="showView('dashboard')"><span class="nav-icon">ğŸ“Š</span>Dashboard</div>
      </div>
      <div class="nav-sec">
        <div class="nav-lbl">Requests</div>
        <div class="nav-item" id="nav-my-requests" onclick="showView('my-requests')"><span class="nav-icon">ğŸ“‹</span>My Requests</div>
        <div class="nav-item hidden" id="nav-all-requests" onclick="showView('all-requests')"><span class="nav-icon">ğŸ“‚</span>All Requests</div>
        <div class="nav-item" id="nav-submit" onclick="showView('submit')"><span class="nav-icon">âœ¦</span>New Request</div>
      </div>
      <div class="nav-sec hidden" id="nav-analytics-sec">
        <div class="nav-lbl">Analytics</div>
        <div class="nav-item" id="nav-analytics" onclick="showView('analytics')"><span class="nav-icon">ğŸ“ˆ</span>Analytics</div>
      </div>
      <div style="padding:.6rem 10px;margin-top:auto;">
        <div class="nav-item" onclick="logout()" style="color:var(--red);margin-top:1rem;"><span class="nav-icon">â†©</span>Sign Out</div>
      </div>
    </div>

    <div class="content">
      <!-- DASHBOARD -->
      <div id="view-dashboard" class="view active">
        <div class="ph"><div class="pt">Dashboard</div><div class="ps">Real-time workflow overview</div></div>
        <div class="welcome"><div class="wt" id="welcome-txt">Good day! ğŸ‘‹</div><div class="ws">Here's what's happening across your organization today.</div></div>
        <div class="stats-grid">
          <div class="stat s-b d1"><div class="si">ğŸ“‹</div><div class="sl">Total</div><div class="sv" id="st-total">â€”</div></div>
          <div class="stat s-a d2"><div class="si">â³</div><div class="sl">Pending</div><div class="sv" id="st-pending">â€”</div></div>
          <div class="stat s-g d3"><div class="si">âœ…</div><div class="sl">Approved</div><div class="sv" id="st-approved">â€”</div></div>
          <div class="stat s-r d4"><div class="si">ğŸš¨</div><div class="sl">Escalated</div><div class="sv" id="st-escalated">â€”</div></div>
        </div>
        <div class="card"><div class="ct">Recent Activity</div><div id="recent-list"><div class="empty"><div class="ei">ğŸ“­</div><div class="et">Loading...</div></div></div></div>
      </div>

      <!-- MY REQUESTS -->
      <div id="view-my-requests" class="view">
        <div class="ph"><div class="pt">My Requests</div><div class="ps">Track all your submitted requests</div></div>
        <div class="card"><div class="tw"><table><thead><tr><th>Title</th><th>Type</th><th>Status</th><th>Level</th><th>Date</th><th>Action</th></tr></thead><tbody id="my-req-body"><tr><td colspan="6"><div class="empty"><div class="ei">ğŸ“­</div><div class="et">No requests</div></div></td></tr></tbody></table></div></div>
      </div>

      <!-- ALL REQUESTS -->
      <div id="view-all-requests" class="view">
        <div class="ph"><div class="pt">All Requests</div><div class="ps">Review and action pending approvals</div></div>
        <div class="card"><div class="tw"><table><thead><tr><th>Title</th><th>Employee</th><th>Type</th><th>Status</th><th>SLA</th><th>Action</th></tr></thead><tbody id="all-req-body"><tr><td colspan="6"><div class="empty"><div class="ei">ğŸ“­</div><div class="et">Loading...</div></div></td></tr></tbody></table></div></div>
      </div>

      <!-- SUBMIT -->
      <div id="view-submit" class="view">
        <div class="ph"><div class="pt">New Request</div><div class="ps">Submit for multi-level approval</div></div>
        <div class="card">
          <div class="ct">Request Details</div>
          <div class="fg2"><label class="fl">Title</label><input id="req-title" type="text" class="fi" placeholder="e.g. Annual leave request"/></div>
          <div class="fr">
            <div class="fg2"><label class="fl">Type</label><select id="req-type" class="fsel"><option value="leave">ğŸŒ´ Leave</option><option value="expense">ğŸ’° Expense</option><option value="wfh">ğŸ  Work From Home</option><option value="overtime">â± Overtime</option></select></div>
            <div class="fg2"><label class="fl">Start Date</label><input id="req-start" type="date" class="fi"/></div>
          </div>
          <div class="fg2"><label class="fl">End Date</label><input id="req-end" type="date" class="fi"/></div>
          <div class="fg2"><label class="fl">Description</label><textarea id="req-desc" class="fta" placeholder="Provide details about your request..."></textarea></div>
          <div style="background:var(--glass);border:1px solid var(--border);border-radius:12px;padding:1rem;margin-top:.5rem;">
            <div style="font-size:.68rem;color:var(--text2);margin-bottom:10px;text-transform:uppercase;letter-spacing:.8px;">Approval Journey</div>
            <div class="lvl-steps">
              <div class="lvl-step"><div class="lc a">L1</div><div class="lt">Manager</div></div>
              <div class="lvl-step"><div class="lc">L2</div><div class="lt">HR</div></div>
              <div class="lvl-step"><div class="lc">L3</div><div class="lt">Admin</div></div>
            </div>
          </div>
          <div style="display:flex;gap:11px;margin-top:1.2rem;">
            <button class="btn-p" style="flex:1;" onclick="submitRequest()">Submit Request â†’</button>
            <button class="btn-s" onclick="clearForm()">Clear</button>
          </div>
          <div id="submit-err" class="err-box"></div>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div id="view-analytics" class="view">
        <div class="ph"><div class="pt">Analytics</div><div class="ps">Workflow performance insights</div></div>
        <div class="stats-grid">
          <div class="stat s-b"><div class="sl">Total</div><div class="sv" id="a-total">â€”</div></div>
          <div class="stat s-a"><div class="sl">Pending</div><div class="sv" id="a-pending">â€”</div></div>
          <div class="stat s-g"><div class="sl">Approved</div><div class="sv" id="a-approved">â€”</div></div>
          <div class="stat s-r"><div class="sl">Escalated</div><div class="sv" id="a-escalated">â€”</div></div>
        </div>
        <div class="card"><div class="ct">Status Breakdown</div><div id="analytics-bars" style="padding:.5rem 0;"></div></div>
      </div>

      <!-- DETAIL -->
      <div id="view-detail" class="view">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:1.5rem;">
          <button class="btn-s" onclick="goBack()" style="padding:8px 15px;">â† Back</button>
          <div><div class="pt" id="det-title">Request</div><div class="ps" id="det-sub">â€”</div></div>
        </div>
        <div class="dg">
          <div>
            <div class="card"><div class="ct">Request Info</div><div id="det-info"></div></div>
            <div class="card"><div class="ct">Approval Timeline</div><div id="det-timeline" class="timeline"></div></div>
          </div>
          <div class="card" id="action-card" style="display:none;">
            <div class="ct">Take Action</div>
            <div class="fg2"><label class="fl">Comment</label><textarea id="action-comment" class="fta" placeholder="Add review comment..." style="min-height:70px;"></textarea></div>
            <div style="display:flex;gap:8px;">
              <button class="bsm bapp" style="flex:1;padding:10px;" onclick="takeAction('approved')">âœ… Approve</button>
              <button class="bsm brej" style="flex:1;padding:10px;" onclick="takeAction('rejected')">âŒ Reject</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV (mobile only) -->
  <nav class="bottom-nav" id="bottom-nav">
    <button class="bn-item active" id="bn-dashboard" onclick="showView('dashboard')"><span class="bn-icon">ğŸ“Š</span><span class="bn-label">Home</span></button>
    <button class="bn-item" id="bn-my-requests" onclick="showView('my-requests')"><span class="bn-icon">ğŸ“‹</span><span class="bn-label">Mine</span></button>
    <button class="bn-item hidden" id="bn-all-requests" onclick="showView('all-requests')"><span class="bn-icon">ğŸ“‚</span><span class="bn-label">All</span></button>
    <button class="bn-item" id="bn-submit" onclick="showView('submit')"><span class="bn-icon">âœ¦</span><span class="bn-label">New</span></button>
    <button class="bn-item hidden" id="bn-analytics" onclick="showView('analytics')"><span class="bn-icon">ğŸ“ˆ</span><span class="bn-label">Stats</span></button>
  </nav>
</div>

</div>
<div class="toast" id="toast"></div>

<script>
const API_BASE = 'http://localhost:5000/api';
let token=localStorage.getItem('fd_token');
let currentUser=JSON.parse(localStorage.getItem('fd_user')||'null');
let lastView='dashboard',currentReqId=null;

window.addEventListener('DOMContentLoaded',()=>{
  if(token&&currentUser)showMainApp();
  const t=new Date().toISOString().split('T')[0];
  document.getElementById('req-start').value=t;
  document.getElementById('req-end').value=t;
});

function toggleSidebar(){
  const s=document.getElementById('sidebar');
  const o=document.getElementById('sidebar-overlay');
  s.classList.toggle('open');
  o.classList.toggle('show');
}
function closeSidebar(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('show');
}

function switchTab(t){
  document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',t==='login'?i===0:i===1));
  document.getElementById('tab-login').classList.toggle('active',t==='login');
  document.getElementById('tab-register').classList.toggle('active',t==='register');
}
function demoLogin(e,p){document.getElementById('login-email').value=e;document.getElementById('login-password').value=p;handleLogin();}

async function handleLogin(){
  const email=document.getElementById('login-email').value.trim();
  const password=document.getElementById('login-password').value;
  const err=document.getElementById('login-err');err.style.display='none';
  if(!email||!password)return showErr(err,'Fill all fields.');
  try{
    const res=await api('/auth/login','POST',{email,password});
    token=res.token;currentUser=res.user||{email};
    if(!currentUser.role){const p=JSON.parse(atob(token.split('.')[1]));currentUser.role=p.role;currentUser._id=p.id;}
    localStorage.setItem('fd_token',token);localStorage.setItem('fd_user',JSON.stringify(currentUser));
    showMainApp();
  }catch(e){showErr(err,e.message||'Login failed.');}
}

async function handleRegister(){
  const name=document.getElementById('reg-name').value.trim();
  const email=document.getElementById('reg-email').value.trim();
  const password=document.getElementById('reg-password').value;
  const role=document.getElementById('reg-role').value;
  const err=document.getElementById('reg-err');err.style.display='none';
  if(!name||!email||!password)return showErr(err,'Fill all fields.');
  try{await api('/auth/register','POST',{name,email,password,role});showToast('Account created! Sign in.');document.getElementById('login-email').value=email;document.getElementById('login-password').value=password;switchTab('login');}
  catch(e){showErr(err,e.message||'Failed.');}
}

function logout(){localStorage.clear();token=null;currentUser=null;document.getElementById('main-page').classList.remove('active');document.getElementById('login-page').classList.add('active');closeSidebar();}

function showMainApp(){
  document.getElementById('login-page').classList.remove('active');
  document.getElementById('main-page').classList.add('active');
  const name=currentUser.name||currentUser.email||'User';
  document.getElementById('top-nm').textContent=name;
  document.getElementById('top-rl').textContent=(currentUser.role||'user').toUpperCase();
  document.getElementById('top-av').textContent=name.slice(0,2).toUpperCase();
  document.getElementById('welcome-txt').textContent=`Good day, ${name.split(' ')[0]}! ğŸ‘‹`;
  const role=currentUser.role;
  if(['manager','hr','admin'].includes(role)){
    document.getElementById('nav-all-requests').classList.remove('hidden');
    document.getElementById('bn-all-requests').classList.remove('hidden');
  }
  if(['hr','admin'].includes(role)){
    document.getElementById('nav-analytics-sec').classList.remove('hidden');
    document.getElementById('bn-analytics').classList.remove('hidden');
  }
  loadDashboard();
}

function showView(v){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.bn-item').forEach(x=>x.classList.remove('active'));
  document.getElementById('view-'+v)?.classList.add('active');
  document.getElementById('nav-'+v)?.classList.add('active');
  document.getElementById('bn-'+v)?.classList.add('active');
  lastView=v;
  closeSidebar();
  if(v==='dashboard')loadDashboard();
  if(v==='my-requests')loadMyRequests();
  if(v==='all-requests')loadAllRequests();
  if(v==='analytics')loadAnalytics();
}
function goBack(){showView(lastView==='detail'?'my-requests':lastView);}

async function api(path,method='GET',body=null){
  const opts={method,headers:{'Content-Type':'application/json'}};
  if(token)opts.headers['Authorization']=`Bearer ${token}`;
  if(body)opts.body=JSON.stringify(body);
  const res=await fetch(API_BASE+path,opts);
  const data=await res.json();
  if(!res.ok)throw new Error(data.message||'Failed');
  return data;
}

async function loadDashboard(){
  try{
    if(['hr','admin'].includes(currentUser.role)){
      const d=(await api('/requests/dashboard/stats')).dashboard||{};
      document.getElementById('st-total').textContent=d.total??0;
      document.getElementById('st-pending').textContent=d.pending??0;
      document.getElementById('st-approved').textContent=d.approved??0;
      document.getElementById('st-escalated').textContent=d.escalated??0;
    }else{
      const reqs=(await api('/requests/my')).requests||[];
      document.getElementById('st-total').textContent=reqs.length;
      document.getElementById('st-pending').textContent=reqs.filter(r=>r.status==='pending').length;
      document.getElementById('st-approved').textContent=reqs.filter(r=>r.status==='approved').length;
      document.getElementById('st-escalated').textContent=reqs.filter(r=>r.status==='escalated').length;
    }
    const src=['manager','hr','admin'].includes(currentUser.role)?'/requests/':'/requests/my';
    const reqs=((await api(src)).requests||[]).slice(0,6);
    document.getElementById('recent-list').innerHTML=reqs.length
      ?reqs.map(r=>`<div class="ri"><div><div class="rt">${r.title}</div><div class="rm">${r.type?.toUpperCase()} Â· ${timeAgo(r.createdAt)}</div></div>${badge(r.status)}</div>`).join('')
      :'<div class="empty"><div class="ei">ğŸ“­</div><div class="et">No activity yet</div></div>';
  }catch(e){console.error(e);}
}

async function loadMyRequests(){
  try{
    const reqs=(await api('/requests/my')).requests||[];
    document.getElementById('my-req-body').innerHTML=reqs.length
      ?reqs.map(r=>`<tr><td style="font-weight:500;">${r.title}</td><td style="color:var(--text2);font-size:.78rem;text-transform:uppercase;">${r.type}</td><td>${badge(r.status)}</td><td>${lvlBadge(r.currentLevel,r.status)}</td><td style="color:var(--text2);font-size:.8rem;">${fmtDate(r.createdAt)}</td><td><button class="bsm bv" onclick="viewDetail('${r._id}')">View â†’</button></td></tr>`).join('')
      :`<tr><td colspan="6"><div class="empty"><div class="ei">ğŸ“­</div><div class="et">No requests. <span style="color:var(--accent);cursor:pointer;" onclick="showView('submit')">Submit one â†’</span></div></div></td></tr>`;
  }catch(e){showToast('Failed to load',true);}
}

async function loadAllRequests(){
  try{
    const reqs=(await api('/requests/')).requests||[];
    document.getElementById('all-req-body').innerHTML=reqs.length
      ?reqs.map(r=>`<tr><td style="font-weight:500;">${r.title}</td><td style="font-size:.8rem;color:var(--text2);">${r.requestedBy?.name||'Employee'}</td><td style="font-size:.78rem;color:var(--text2);text-transform:uppercase;">${r.type}</td><td>${badge(r.status)}</td><td style="font-size:.78rem;color:${slaColor(r.slaDeadline)};">${slaLabel(r.slaDeadline)}</td><td><button class="bsm bv" onclick="viewDetail('${r._id}')">Review â†’</button></td></tr>`).join('')
      :`<tr><td colspan="6"><div class="empty"><div class="ei">ğŸ“­</div><div class="et">No requests</div></div></td></tr>`;
  }catch(e){showToast('Failed to load',true);}
}

async function submitRequest(){
  const title=document.getElementById('req-title').value.trim();
  const type=document.getElementById('req-type').value;
  const description=document.getElementById('req-desc').value.trim();
  const startDate=document.getElementById('req-start').value;
  const endDate=document.getElementById('req-end').value;
  const err=document.getElementById('submit-err');err.style.display='none';
  if(!title||!description)return showErr(err,'Title and description required.');
  try{await api('/requests/submit','POST',{title,type,description,startDate,endDate});showToast('Submitted! ğŸ‰');clearForm();showView('my-requests');}
  catch(e){showErr(err,e.message||'Failed.');}
}
function clearForm(){['req-title','req-desc'].forEach(i=>document.getElementById(i).value='');document.getElementById('req-type').value='leave';}

async function viewDetail(id){
  currentReqId=id;
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-detail').classList.add('active');
  try{
    const raw=await api(`/requests/${id}`);
    const r=raw.request||raw;
    document.getElementById('det-title').textContent=r.title;
    document.getElementById('det-sub').textContent=`${r.type?.toUpperCase()} Â· ${r.requestedBy?.name||'Employee'} Â· ${fmtDate(r.createdAt)}`;
    document.getElementById('det-info').innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;"><div><div style="font-size:.68rem;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;">Status</div>${badge(r.status)}</div><div><div style="font-size:.68rem;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;">Level</div>${lvlBadge(r.currentLevel,r.status)}</div><div><div style="font-size:.68rem;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;">Start</div><div style="font-size:.85rem;">${fmtDate(r.startDate)}</div></div><div><div style="font-size:.68rem;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;">End</div><div style="font-size:.85rem;">${fmtDate(r.endDate)}</div></div><div style="grid-column:1/-1;"><div style="font-size:.68rem;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;">Description</div><div style="font-size:.85rem;line-height:1.6;color:var(--text2);">${r.description||'â€”'}</div></div><div><div style="font-size:.68rem;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;">SLA Deadline</div><div style="font-size:.8rem;color:${slaColor(r.slaDeadline)};">${r.slaDeadline?new Date(r.slaDeadline).toLocaleString():'â€”'}</div></div></div>`;
    const matrix=r.approvalMatrix||[];
    const steps=[{level:1,label:'Manager Review'},{level:2,label:'HR Review'},{level:3,label:'Admin Final Approval'}];
    document.getElementById('det-timeline').innerHTML=steps.map(s=>{
      const e=matrix.find(m=>m.level===s.level);
      if(e){const cls=e.action==='approved'?'done':'rej';return `<div class="tl-item"><div class="tl-dot ${cls}"></div><div class="tl-t">${s.label} â€” <span style="color:var(--text2);font-weight:400;">${e.action?.toUpperCase()}</span></div><div class="tl-m">${e.comment||'No comment'} Â· ${fmtDate(e.actionAt)}</div></div>`;}
      const cur=r.currentLevel===s.level&&!['approved','rejected'].includes(r.status);
      return `<div class="tl-item"><div class="tl-dot ${cur?'':'wait'}"></div><div class="tl-t" style="color:${cur?'var(--accent)':'var(--text2)'};">${s.label}${cur?' â† Awaiting':''}</div><div class="tl-m">${cur?'In queue':'Not reached yet'}</div></div>`;
    }).join('')+(r.status==='approved'?`<div class="tl-item"><div class="tl-dot done"></div><div class="tl-t" style="color:var(--green);">âœ… Fully Approved</div></div>`:'');
    const role=currentUser.role;
    const canAct=(role==='manager'&&r.currentLevel===1&&r.status==='pending')||(role==='hr'&&r.currentLevel===2&&r.status==='approved_by_manager')||(role==='admin'&&r.currentLevel===3&&r.status==='approved_by_hr');
    document.getElementById('action-card').style.display=canAct?'block':'none';
  }catch(e){showToast('Failed to load',true);}
}

async function takeAction(action){
  const comment=document.getElementById('action-comment').value.trim()||(action==='approved'?'Approved':'Rejected');
  try{await api(`/requests/${currentReqId}/action`,'PATCH',{action,comment});showToast(`Request ${action} âœ…`);viewDetail(currentReqId);}
  catch(e){showToast(e.message||'Failed',true);}
}

async function loadAnalytics(){
  try{
    const d=(await api('/requests/dashboard/stats')).dashboard||{};
    document.getElementById('a-total').textContent=d.total??0;
    document.getElementById('a-pending').textContent=d.pending??0;
    document.getElementById('a-approved').textContent=d.approved??0;
    document.getElementById('a-escalated').textContent=d.escalated??0;
    const total=d.total||1;
    const bars=[{label:'Approved',val:d.approved||0,color:'var(--green)'},{label:'Pending',val:d.pending||0,color:'var(--amber)'},{label:'Rejected',val:d.rejected||0,color:'var(--red)'},{label:'Escalated',val:d.escalated||0,color:'var(--accent2)'}];
    document.getElementById('analytics-bars').innerHTML=bars.map(b=>`<div class="ab-item"><div class="ab-h"><span>${b.label}</span><span style="color:var(--text2);">${b.val}</span></div><div class="ab-tr"><div class="ab-fi" style="width:${Math.round((b.val/total)*100)}%;background:${b.color};"></div></div></div>`).join('');
  }catch(e){showToast('Failed',true);}
}

function badge(s){const m={pending:['b-pend','â³ Pending'],approved_by_manager:['b-l1','âœ” Mgr Approved'],approved_by_hr:['b-l2','âœ” HR Approved'],approved:['b-appr','âœ… Approved'],rejected:['b-reje','âŒ Rejected'],escalated:['b-esca','ğŸš¨ Escalated']};const[c,l]=m[s]||['','â€”'];return `<span class="badge ${c}">${l}</span>`;}
function lvlBadge(l,s){if(s==='approved')return`<span class="badge b-appr">Complete</span>`;if(s==='rejected')return`<span class="badge b-reje">Stopped</span>`;const c={1:'b-l1',2:'b-l2',3:'b-l3'},lb={1:'L1 Â· Manager',2:'L2 Â· HR',3:'L3 Â· Admin'};return`<span class="badge ${c[l]||''}">${lb[l]||'â€”'}</span>`;}
function slaColor(d){if(!d)return'var(--text2)';const diff=new Date(d)-Date.now();return diff<0?'var(--red)':diff<28800000?'var(--amber)':'var(--green)';}
function slaLabel(d){if(!d)return'â€”';const diff=new Date(d)-Date.now();if(diff<0)return'âš  Breached';return`${Math.floor(diff/3600000)}h left`;}
function fmtDate(d){if(!d)return'â€”';return new Date(d).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'});}
function timeAgo(d){if(!d)return'';const diff=Date.now()-new Date(d);const m=Math.floor(diff/60000);if(m<60)return`${m}m ago`;const h=Math.floor(m/60);return h<24?`${h}h ago`:`${Math.floor(h/24)}d ago`;}
function showErr(el,msg){el.textContent=msg;el.style.display='block';}
function showToast(msg,isErr=false){const t=document.getElementById('toast');t.textContent=msg;t.className='toast show'+(isErr?' err':'');setTimeout(()=>t.className='toast',3000);}
</script>
</body>
</html>